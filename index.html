<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <!-- <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png"> -->
    <!-- <link rel="icon" type="image/png" href="../assets/img/favicon.png"> -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>
        Employee
    </title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <!-- CSS Files -->
    <link href="./css/bootstrap.min.css" rel="stylesheet" />
    <link href="./css/now-ui-dashboard.css?v=1.5.0" rel="stylesheet" />
    <style>
        .header {
            font-size: 10px;
            font-weight: 900;
            color: black!important;
        }
    </style>
</head>

<body class="">
    <div class="wrapper ">
        <div class="sidebar" data-color="orange">
            <!--
        Tip 1: You can change the color of the sidebar using: data-color="blue | green | orange | red | yellow"
    -->
            <div class="logo">
                <a href="http://www.creative-tim.com" class="simple-text logo-mini">
          PS
        </a>
                <a href="http://www.creative-tim.com" class="simple-text logo-normal">
          Pay Slips
        </a>
            </div>
            <div class="sidebar-wrapper" id="sidebar-wrapper">
                <ul class="nav">


                    <li class="active ">
                        <a href="./index.html">
                            <i class="now-ui-icons users_single-02"></i>
                            <p>Add Employees</p>
                        </a>
                    </li>
                    <!-- <li>
                        <a href="./payslip.html">
                            <i class="now-ui-icons design_bullet-list-67"></i>
                            <p>old PaySilp</p>
                        </a>
                    </li> -->
                    <li>
                        <a href="./slip.html">
                            <i class="now-ui-icons design_bullet-list-67"></i>
                            <p>PaySilp</p>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="main-panel" id="main-panel">
            <div class="content" style="margin-top: 25px;">
                <div class="row">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header row">
                                <h4 class="card-title col" style="margin-right: 5px;line-height: unset;"> Employees</h4>
                                <input type="text" class="form-control col " style="margin: 10px;height: 37px;" onkeyup="search(event.target.value)" placeholder="Search" value="">
                                <!-- <input type="text" class="form-control  col-md-2  " style="margin: auto;line-height: unset;" placeholder="Date Picker" value=""> -->
                                <button type="button" onclick="" class="btn btn-sm btn-primary col" style="margin-right: 25px;line-height: unset;border-radius: 25px;" data-toggle="modal" data-target="#saveexampleModal">Add New Employee</button>
                                <!-- <button type="button" onclick="" class="btn btn-sm btn-primary col" style="margin-right: 5px;line-height: unset;border-radius: 25px;" data-toggle="modal" data-target="#saveexampleModal">Add New Sheet</button> -->

                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table">
                                        <thead class="header text-primary">
                                            <th>
                                                S.N
                                            </th>
                                            <th>
                                                Worker No.
                                            </th>
                                            <th>
                                                Worker Name
                                            </th>
                                            <th>
                                                N.I.C No.
                                            </th>
                                            <th>
                                                Designation Name
                                            </th>
                                            <th>
                                                Amount
                                            </th>

                                            <th>
                                                Edit
                                            </th>
                                        </thead>
                                        <tbody id="dataTable">

                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="modal fade" id="saveexampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel"> Entry</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="row">

                                    <div class="col">
                                        <div class="form-group">
                                            <label>Worker No.</label>
                                            <input type="text" id="workerno" class="form-control" placeholder="" value="">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-group">
                                            <label for="exampleInputEmail1">Worker Name</label>
                                            <input type="text" id="workername" class="form-control" placeholder="">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 pr-1">
                                        <div class="form-group">
                                            <label>C.N.I.C No.</label>
                                            <input type="text" id="cncic" class="form-control" placeholder="" value="">
                                        </div>
                                    </div>
                                    <div class="col-md-6 pl-1">
                                        <div class="form-group">
                                            <label>Designation Name</label>
                                            <input type="text" id="designation" class="form-control" placeholder="" value="">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <div class="form-group">
                                            <label>Amount</label>
                                            <input type="number" id="actualamount" class="form-control" placeholder="" value="0">
                                        </div>
                                    </div>

                                </div>

                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>Remarks</label>
                                            <textarea rows="4" cols="80" id="remarks" class="form-control" placeholder="Add Remarks here !" value=""></textarea>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" onclick="save()" class="btn btn-primary">Save Record</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="editexampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel"> Entry</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
                        </div>
                        <div class="modal-body">
                            <form>
                                <div class="row">

                                    <div class="col">
                                        <div class="form-group">
                                            <label>Worker No.</label>
                                            <input type="text" id="editworkerno" class="form-control" placeholder="" value="">
                                            <input type="text" id="editid" value="" style="display: none;">
                                            <input type="text" id="editrev" value="" style="display: none;">
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-group">
                                            <label for="exampleInputEmail1">Worker Name</label>
                                            <input type="text" id="editworkername" class="form-control" placeholder="">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>C.N.I.C No.</label>
                                            <input type="text" id="editcncic" class="form-control" placeholder="" value="">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>Designation Name</label>
                                            <input type="text" id="editdesignation" class="form-control" placeholder="" value="">
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <div class="form-group">
                                            <label>Amount</label>
                                            <input type="number" id="editactualamount" class="form-control" placeholder="" value="0">
                                        </div>
                                    </div>

                                </div>

                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label>Remarks</label>
                                            <textarea rows="4" cols="80" id="editremarks" class="form-control" placeholder="Add Remarks here !" value=""></textarea>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" onclick="edit()" class="btn btn-primary">Edit Record</button>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="footer">
                <div class=" container-fluid ">
                    <nav>
                        <ul>
                            <li>
                                <a href="https://www.blackruby.pk">
                  BlackRuby
                </a>
                            </li>

                        </ul>
                    </nav>
                    <div class="copyright" id="copyright">
                        &copy;
                        <script>
                            document.getElementById('copyright').appendChild(document.createTextNode(new Date().getFullYear()))
                        </script>, Designed by <a href="http://blackruby.pk/" target="_blank">BlackRuby</a>. Coded by <a href="http://blackruby.pk/" target="_blank">BlackRuby</a>.
                    </div>
                </div>
            </footer>
        </div>
    </div>
    <!--   Core JS Files   -->

    <script src="./jquery.min.js"></script>
    <script src="./popper.min.js"></script>
    <script src="./bootstrap.min.js"></script>
    <script src="./perfect-scrollbar.jquery.min.js"></script>
    <script src="./now-ui-dashboard.min.js?v=1.5.0" type="text/javascript"></script>
    <script src="./pouchdb.js"></script>
    <script src="./pouchfind.js"></script>
    <script src="./bootstrap-datepicker.js"></script>
    <script src="./pouchdb.js"></script>
    <script src="./pouchfind.js"></script>
    <script src="./data.js"></script>


    <script>
        var db = new PouchDB('payDb');

        function populate() {
            db.find({
                selector: {
                    type: 'employee',
                },
            }).then((result) => {
                console.log("data length", data.length)
                if (result.docs.length <= 0) {
                    var newdata = [];
                    data.forEach(e => {
                        delete e['S.N.'];
                        delete e['Hatno'];
                        e.type = 'employee';
                        // console.log(e)
                        // db.post(e)
                        newdata.push(e)
                    });
                    // console.log("no data found", result, newdata);
                    db.bulkDocs(newdata)
                    render('')

                } else {

                }
                // result.docs.forEach(x => {
                //     delete x._id;
                //     delete x._rev;
                //     delete x.Remarks;
                //     x.type = "slip";
                //     x["Remaining Amount"] = 0;
                //     x["Advance Amount"] = 0;
                //     x["Nadara Cutting"] = 0;
                //     x["Mess Cutting"] = 0;
                //     if (result.docs.legnth > 0) {
                //         db.put(x)
                //     }
                //     // console.log(x);

                // });
            })
        }
        populate()

        function render(value) {
            db.find({
                selector: {
                    type: 'employee',
                    WorkNo: {
                        $regex: value
                    }
                },
            }).then((result) => {
                // console.log("returned data ", result.docs);
                data = result.docs;
                var html = "";
                data.forEach((e, index) => {
                    html += `
                              <tr>
                              <td>
                                  ${index+1}
                              </td>
                              <td>
                                  ${e["WorkNo"]}
                              </td>
                              <td>
                                  ${e["WorkerName"]}
                              </td>
                              <td>
                                  ${e["C-N-I-C NO."]}
                              </td>
                              <td>
                                  ${(e["Craft/Post"]).slice(0, 7)}
                              </td>
                              <td>
                                  ${e["Actualamount"]}
                              </td>

                              <td>
                                  <a href="" onclick="openedit('${e._id}')" data-toggle="modal" data-target="#editexampleModal">
                                      <i class="now-ui-icons ui-2_settings-90"></i>
                                  </a>
                                  <a href="" onclick="del('${e._id}')" >
                                      <i class="now-ui-icons ui-1_simple-remove"></i>
                                  </a>
                              </td>
                            </tr>
                            `;
                });
                document.getElementById('dataTable').innerHTML = html
            }).catch(function(err) {
                console.log(err);
            });
        }
        render('')

        function del(value) {
            db.get(value).then(function(doc) {
                return db.remove(doc);
            }).then(function(result) {
                // handle result
            }).catch(function(err) {
                console.log(err);
            });
            render('')
        }

        function openedit(obj) {
            db.get(obj).then(function(doc) {
                console.log(doc, doc["WorkNo"])

                $('#editworkerno').val(doc['WorkNo']);
                $('#editid').val(doc['_id']);
                $('#editrev').val(doc['_rev']);
                $('#editworkername').val(doc['WorkerName']);
                $('#editcncic').val(doc['C-N-I-C NO.']);
                $('#editdesignation').val(doc['Craft/Post']);
                $('#editactualamount').val(doc['Actualamount']);
                $('#editremarks').val(doc['Remarks']);
                $('#editexampleModal').modal('show')
            }).then(function(result) {
                // handle result
            }).catch(function(err) {
                console.log(err);
            });
            // render('')


        }

        function edit() {
            // var index = $('#index').val();
            var obj = {}
            obj["WorkNo"] = $('#editworkerno').val();
            obj["_id"] = $('#editid').val();
            obj["_rev"] = $('#editrev').val();
            obj["WorkerName"] = $('#editworkername').val();
            obj["C-N-I-C NO."] = $('#editcncic').val();
            obj["Craft/Post"] = $('#editdesignation').val();
            obj["Actualamount"] = $('#editactualamount').val();
            obj["Remarks"] = $('#editremarks').val();
            obj["type"] = 'employee';
            render('')

            console.log("edit data ", obj)
            db.put(obj).then(function(response) {
                // handle response
                $('#editexampleModal').modal('hide')
            }).catch(function(err) {
                console.log(err);
            });

        }

        function search(value) {
            console.log("search value is ", value);
            render(value)

        }

        function save() {
            var obj = {};
            obj["WorkNo"] = $('#workerno').val();
            obj["WorkerName"] = $('#workername').val();
            obj["C-N-I-C NO."] = $('#cncic').val();
            obj["Craft/Post"] = $('#designation').val();
            obj["Actualamount"] = $('#actualamount').val();
            obj["Remarks"] = $('#remarks').val();
            obj["type"] = 'employee'
            console.log("save entry of employee  ", obj);
            if ($('#workerno').val() != "") {
                console.log("submitted")
                db.post(obj).then(function(response) {
                    // handle response
                    $('#saveexampleModal').modal('hide')
                    render('')

                }).catch(function(err) {
                    console.log(err);
                });
            } else {
                console.log("not submitted")

            }
        }
    </script>
</body>

</html>